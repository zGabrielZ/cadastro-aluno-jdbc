create schema dev;

create table dev.USUARIO (
ID INT NOT NULL,
NOME VARCHAR(255) NOT NULL,
EMAIL VARCHAR(255) NOT NULL,
SENHA VARCHAR(255) NOT NULL,
CONSTRAINT USUARIO_PK PRIMARY KEY(ID)
);

CREATE SEQUENCE dev.USUARIO_SEQUENCE_ID
INCREMENT 1
MINVALUE 1
MAXVALUE 9223372036854775807
START 1;

ALTER TABLE dev.USUARIO ALTER COLUMN ID SET DEFAULT NEXTVAL('dev.USUARIO_SEQUENCE_ID'::regclass);

alter table dev.usuario add constraint ck_email_unique unique(email);

alter table dev.usuario add column data_nascimento DATE;
alter table dev.usuario alter column data_nascimento set not null;

alter table dev.usuario add column cpf varchar(11);
alter table dev.usuario alter column cpf set not null;
alter table dev.usuario add constraint ck_cpf_unique unique(cpf);

alter table dev.usuario add column nome_social varchar(255);

create table dev.GENERO (
ID INT NOT NULL,
DESCRICAO VARCHAR(255) NOT NULL,
CODIGO VARCHAR(255) NOT NULL,
CONSTRAINT GENERO_PK PRIMARY KEY(ID)
);

CREATE SEQUENCE dev.GENERO_SEQUENCE_ID
INCREMENT 1
MINVALUE 1
MAXVALUE 9223372036854775807
START 1;

ALTER TABLE dev.GENERO ALTER COLUMN ID SET DEFAULT NEXTVAL('dev.GENERO_SEQUENCE_ID'::regclass);

ALTER TABLE dev.usuario add column ID_GENERO INT;
ALTER TABLE dev.usuario ADD FOREIGN KEY (ID_GENERO) REFERENCES dev.GENERO(ID);

INSERT INTO dev.genero (descricao, codigo) VALUES ('Masculino', 'MASCULINO');
INSERT INTO dev.genero (descricao, codigo) VALUES ('Feminino', 'FEMININO');

create table dev.PERFIL (
ID INT NOT NULL,
DESCRICAO VARCHAR(255) NOT NULL,
CODIGO VARCHAR(255) NOT NULL,
CONSTRAINT PERFIL_PK PRIMARY KEY(ID)
);

CREATE SEQUENCE dev.PERFIL_SEQUENCE_ID
INCREMENT 1
MINVALUE 1
MAXVALUE 9223372036854775807
START 1;

ALTER TABLE dev.PERFIL ALTER COLUMN ID SET DEFAULT NEXTVAL('dev.PERFIL_SEQUENCE_ID'::regclass);

ALTER TABLE dev.usuario add column ID_PERFIL INT;
ALTER TABLE dev.usuario ADD FOREIGN KEY (ID_PERFIL) REFERENCES dev.PERFIL(ID);


INSERT INTO dev.perfil (descricao, codigo) VALUES ('Administrador', 'ADMINISTRADOR');
INSERT INTO dev.perfil (descricao, codigo) VALUES ('Aluno', 'ALUNO');
INSERT INTO dev.perfil (descricao, codigo) VALUES ('Professor', 'PROFESSOR');

alter table dev.usuario alter column id_perfil set not null;

create table dev.TIPO_TELEFONE (
ID INT NOT NULL,
DESCRICAO VARCHAR(255) NOT NULL,
CODIGO VARCHAR(255) not null,
CONSTRAINT TIPO_TELEFONE_PK PRIMARY KEY(ID)
);

CREATE SEQUENCE dev.TIPO_TELEFONE_SEQUENCE_ID
INCREMENT 1
MINVALUE 1
MAXVALUE 9223372036854775807
START 1;

ALTER TABLE dev.TIPO_TELEFONE ALTER COLUMN ID SET DEFAULT NEXTVAL('dev.TIPO_TELEFONE_SEQUENCE_ID'::regclass);

INSERT INTO dev.TIPO_TELEFONE (DESCRICAO, CODIGO) VALUES ('Residencial', 'RESIDENCIAL');
INSERT INTO dev.TIPO_TELEFONE (DESCRICAO, CODIGO) VALUES ('Celular', 'CELULAR');

create table dev.TELEFONE (
ID INT NOT NULL,
DDD VARCHAR(255) not null,
NUMERO VARCHAR(255) NOT NULL,
ID_USUARIO INT NOT NULL,
ID_TIPO_TELEFONE INT NOT NULL,
CONSTRAINT TELEFONE_PK PRIMARY KEY(ID)
);

CREATE SEQUENCE dev.TELEFONE_SEQUENCE_ID
INCREMENT 1
MINVALUE 1
MAXVALUE 9223372036854775807
START 1;

ALTER TABLE dev.TELEFONE ALTER COLUMN ID SET DEFAULT NEXTVAL('dev.TELEFONE_SEQUENCE_ID'::regclass);

ALTER TABLE dev.TELEFONE ADD FOREIGN KEY (ID_USUARIO) REFERENCES dev.USUARIO(ID);
ALTER TABLE dev.TELEFONE ADD FOREIGN KEY (ID_TIPO_TELEFONE) REFERENCES dev.TIPO_TELEFONE(ID);