create schema test;

create table test.USUARIO (
ID INT NOT NULL,
NOME VARCHAR(255) NOT NULL,
EMAIL VARCHAR(255) NOT NULL,
SENHA VARCHAR(255) NOT NULL,
CONSTRAINT USUARIO_PK PRIMARY KEY(ID)
);

CREATE SEQUENCE test.USUARIO_SEQUENCE_ID
INCREMENT 1
MINVALUE 1
MAXVALUE 9223372036854775807
START 1;

ALTER TABLE test.USUARIO ALTER COLUMN ID SET DEFAULT NEXTVAL('test.USUARIO_SEQUENCE_ID'::regclass);

alter table TEST.usuario add constraint ck_email_unique unique(email);

alter table test.usuario add column data_nascimento DATE;
alter table test.usuario alter column data_nascimento set not null;

alter table test.usuario add column cpf varchar(11);
alter table test.usuario alter column cpf set not null;
alter table TEST.usuario add constraint ck_cpf_unique unique(cpf);

alter table test.usuario add column nome_social varchar(255);

create table test.GENERO (
ID INT NOT NULL,
DESCRICAO VARCHAR(255) NOT NULL,
CODIGO VARCHAR(255) NOT NULL,
CONSTRAINT GENERO_PK PRIMARY KEY(ID)
);

CREATE SEQUENCE test.GENERO_SEQUENCE_ID
INCREMENT 1
MINVALUE 1
MAXVALUE 9223372036854775807
START 1;

ALTER TABLE test.GENERO ALTER COLUMN ID SET DEFAULT NEXTVAL('test.GENERO_SEQUENCE_ID'::regclass);

ALTER TABLE test.usuario add column ID_GENERO INT;
ALTER TABLE test.usuario ADD FOREIGN KEY (ID_GENERO) REFERENCES test.GENERO(ID);

INSERT INTO test.genero (descricao, codigo) VALUES ('Masculino', 'MASCULINO');
INSERT INTO test.genero (descricao, codigo) VALUES ('Feminino', 'FEMININO');

create table test.PERFIL (
ID INT NOT NULL,
DESCRICAO VARCHAR(255) NOT NULL,
CODIGO VARCHAR(255) NOT NULL,
CONSTRAINT PERFIL_PK PRIMARY KEY(ID)
);

CREATE SEQUENCE test.PERFIL_SEQUENCE_ID
INCREMENT 1
MINVALUE 1
MAXVALUE 9223372036854775807
START 1;

ALTER TABLE test.PERFIL ALTER COLUMN ID SET DEFAULT NEXTVAL('test.PERFIL_SEQUENCE_ID'::regclass);

ALTER TABLE test.usuario add column ID_PERFIL INT;
ALTER TABLE test.usuario ADD FOREIGN KEY (ID_PERFIL) REFERENCES test.PERFIL(ID);


INSERT INTO test.perfil (descricao, codigo) VALUES ('Administrador', 'ADMINISTRADOR');
INSERT INTO test.perfil (descricao, codigo) VALUES ('Aluno', 'ALUNO');
INSERT INTO test.perfil (descricao, codigo) VALUES ('Professor', 'PROFESSOR');

alter table test.usuario alter column id_perfil set not null;

create table test.TIPO_TELEFONE (
ID INT NOT NULL,
DESCRICAO VARCHAR(255) NOT NULL,
CODIGO VARCHAR(255) not null,
CONSTRAINT TIPO_TELEFONE_PK PRIMARY KEY(ID)
);

CREATE SEQUENCE test.TIPO_TELEFONE_SEQUENCE_ID
INCREMENT 1
MINVALUE 1
MAXVALUE 9223372036854775807
START 1;

ALTER TABLE test.TIPO_TELEFONE ALTER COLUMN ID SET DEFAULT NEXTVAL('test.TIPO_TELEFONE_SEQUENCE_ID'::regclass);

INSERT INTO test.TIPO_TELEFONE (DESCRICAO, CODIGO) VALUES ('Residencial', 'RESIDENCIAL');
INSERT INTO test.TIPO_TELEFONE (DESCRICAO, CODIGO) VALUES ('Celular', 'CELULAR');

create table test.TELEFONE (
ID INT NOT NULL,
DDD VARCHAR(255) not null,
NUMERO VARCHAR(255) NOT NULL,
ID_USUARIO INT NOT NULL,
ID_TIPO_TELEFONE INT NOT NULL,
CONSTRAINT TELEFONE_PK PRIMARY KEY(ID)
);

CREATE SEQUENCE test.TELEFONE_SEQUENCE_ID
INCREMENT 1
MINVALUE 1
MAXVALUE 9223372036854775807
START 1;

ALTER TABLE test.TELEFONE ALTER COLUMN ID SET DEFAULT NEXTVAL('test.TELEFONE_SEQUENCE_ID'::regclass);

ALTER TABLE test.TELEFONE ADD FOREIGN KEY (ID_USUARIO) REFERENCES test.USUARIO(ID);
ALTER TABLE test.TELEFONE ADD FOREIGN KEY (ID_TIPO_TELEFONE) REFERENCES test.TIPO_TELEFONE(ID);